{% extends "mainView.html" %}
{% block content %}

<br>
<hr style="margin-bottom:5px !important; margin-top:5px !important; " />

<h1>Parametry pracy systemu</h1>
<hr style="margin-bottom:5px !important; margin-top:5px !important; " />
<h3>Pompa</h3>
<div id="pumpStatusArea" class="p-3 mb-2 bg-secondary text-white">
	Stan pompy:
	<div id="pumpState" style="display: inline-block;">Wczytywanie danych...</div> 
</div>
<hr style="margin-bottom:5px !important; margin-top:5px !important; " />
<h3>Tabela temperatur</h3>
<table class="table table-striped table-hover">
  <thead>
    <tr class="table-active">
      <th scope="col">#</th>
      <th scope="col">Czujnik</th>
      <th scope="col">Wartość (&#8451;)</th>
    </tr>
  </thead>
  <tbody>
    <tr class="table-success">
      <th scope="row">1</th>
      <td>Temperatura po lewej</td>
      <td id="left_sensor_temperature">-</td>
    </tr>
    <tr class="table-danger">
      <th scope="row">2</th>
      <td>Temperatura po środku</td>
      <td id="middle_sensor_temperature">-</td>
    </tr>
    <tr class="table-warning">
      <th scope="row">3</th>
      <td>Temperatura po prawej</td>
      <td id="right_sensor_temperature">-</td>
    </tr>
    <tr class="table-secondary">
      <th scope="row">4</th>
      <td>Temperatura w zbiorniku</td>
      <td id="tank_sensor_temperature">-</td>
    </tr>
  </tbody>
</table>
<hr style="margin-bottom:5px !important; margin-top:5px !important; " />
<h3>Dane systemu</h3>
<table class="table table-striped table-hover">
  <thead>
    <tr class="table-active">
      <th scope="col">#</th>
      <th scope="col">Nazwa parametru</th>
      <th scope="col">Wartość</th>
    </tr>
  </thead>
  <tbody>
    <tr class="table-success">
      <th scope="row">1</th>
      <td>Aktywność procesora</td>
      <td id="cpu_usage">-</td>
    </tr>
    <tr class="table-danger">
      <th scope="row">2</th>
      <td>Temperatura procesora</td>
      <td id="cpu_temperature">-</td>
    </tr>
  </tbody>
</table>
{% endblock %}

{% block scripts %}
  <script>
    $(document).ready(function(){
      let protocol = location.protocol === "https:" ? "wss" : "ws"; // Temporarily autodetect a protocol scheme. In production change it to wss only!!!
      var chatSocket = new WebSocket(protocol + '://' + window.location.host + '/parametersPreview/');
   
      chatSocket.onmessage = function(e) {
          var data = JSON.parse(e.data);
          document.getElementById('left_sensor_temperature').innerHTML = !!data['left_sensor_temperature'] ? Math.round(data['left_sensor_temperature']) : '-';
          document.getElementById('middle_sensor_temperature').innerHTML = !!data['middle_sensor_temperature'] ?  Math.round(data['middle_sensor_temperature']) : '-';
          document.getElementById('right_sensor_temperature').innerHTML = !!data['right_sensor_temperature'] ? Math.round(data['right_sensor_temperature']) : '-';
          document.getElementById('tank_sensor_temperature').innerHTML = !!data['tank_sensor_temperature'] ? Math.round(data['tank_sensor_temperature']) : '-';
          let pumpState = Math.round(data['pump_state']);
          document.getElementById('pumpState').innerHTML = pumpState === 1 ? "Uruchomiona" : "Wyłączona";
          if (pumpState === 1) {
          	$("#pumpStatusArea").attr("class", "p-3 mb-2 bg-danger text-white");
          } else {
          	$("#pumpStatusArea").attr("class", "p-3 mb-2 bg-success text-white");
          }

          document.getElementById('cpu_usage').innerHTML = !!data['cpu_usage'] ? ((data['cpu_usage']) + '%') : '-';
          document.getElementById('cpu_temperature').innerHTML = !!data['cpu_temperature'] ? (data['cpu_temperature'] + '&#8451;') : '-';
      };

      chatSocket.onclose = function(e) {
          chatSocket.close();
          console.error('Padło');
      };

      setInterval(function(){ 
        chatSocket.send(JSON.stringify({
          'message': ''
        })); 
      }, 1000);
    });
  </script>
{% endblock %}