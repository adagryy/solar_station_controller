{% extends "mainView.html" %}
{% block content %}

<br>
<hr style="margin-bottom:5px !important; margin-top:5px !important; " />

<h1>Parametry pracy systemu</h1>
<hr style="margin-bottom:5px !important; margin-top:5px !important; " />
<h3>Pompa</h3>
<div id="pumpStatusArea" class="p-3 mb-2 bg-secondary text-white">
	Stan pompy:
	<div id="pumpState" style="display: inline-block;">Wczytywanie danych...</div> 
</div>
<hr style="margin-bottom:5px !important; margin-top:5px !important; " />
<h3>Tabela temperatur</h3>
<table class="table table-striped table-hover">
  <thead>
    <tr class="table-active">
      <th scope="col">#</th>
      <th scope="col">Czujnik</th>
      <th scope="col">Wartość (&#8451;)</th>
    </tr>
  </thead>
  <tbody>
    <tr class="table-success">
      <th scope="row">1</th>
      <td>Temperatura po lewej</td>
      <td id="left_sensor_temperature">-</td>
    </tr>
    <tr class="table-danger">
      <th scope="row">2</th>
      <td>Temperatura po środku</td>
      <td id="middle_sensor_temperature">-</td>
    </tr>
    <tr class="table-warning">
      <th scope="row">3</th>
      <td>Temperatura po prawej</td>
      <td id="right_sensor_temperature">-</td>
    </tr>
    <tr class="table-secondary">
      <th scope="row">4</th>
      <td>Temperatura w zbiorniku</td>
      <td id="tank_sensor_temperature">-</td>
    </tr>
  </tbody>
</table>
<hr style="margin-bottom:5px !important; margin-top:5px !important; " />
<h3>Dane systemu</h3>
<table class="table table-striped table-hover">
  <thead>
    <tr class="table-active">
      <th scope="col">#</th>
      <th scope="col">Nazwa parametru</th>
      <th scope="col">Wartość</th>
    </tr>
  </thead>
  <tbody>
    <tr class="table-success">
      <th scope="row">1</th>
      <td>Aktywność procesora</td>
      <td id="cpu_usage">-</td>
    </tr>
    <tr class="table-danger">
      <th scope="row">2</th>
      <td>Temperatura procesora</td>
      <td id="cpu_temperature">-</td>
    </tr>
  </tbody>
</table>

<canvas id="myChart" width="400" height="400"></canvas>

{% endblock %}

{% block scripts %}
  <script>
    $(document).ready(function(){
      let protocol = location.protocol === "https:" ? "wss" : "ws"; // Temporarily autodetect a protocol scheme. In production change it to wss only!!!
      var chatSocket = new WebSocket(protocol + '://' + window.location.host + '/parametersPreview/');
  
      chatSocket.onmessage = function(e) {
          let data = JSON.parse(e.data);
          let typeOfResponse = (response, unit = '', roundBase = 2) => {
            if(!isNaN(response)) {
              return Number(response).toFixed(roundBase) + unit;
            }
            if(typeof response === "string") {
              return response;
            }
            if(typeof response === "undefined") {
              return "Brak danych!".italics();
            }else{
              return "Nieznany błąd!";
            }
          }
          document.getElementById('left_sensor_temperature').innerHTML = typeOfResponse(data['left_sensor_temperature']);
          document.getElementById('middle_sensor_temperature').innerHTML = typeOfResponse(data['middle_sensor_temperature']);
          document.getElementById('right_sensor_temperature').innerHTML = typeOfResponse(data['right_sensor_temperature']);
          document.getElementById('tank_sensor_temperature').innerHTML = typeOfResponse(data['tank_sensor_temperature']);
          document.getElementById('cpu_usage').innerHTML = typeOfResponse(data['cpu_usage'], "%", 1);
          document.getElementById('cpu_temperature').innerHTML = typeOfResponse(data['cpu_temperature'], '&#8451;', 2);
          
          let pumpState = Math.round(data['pump_state']);
          if(pumpState === 1){
            $("#pumpStatusArea").attr("class", "p-3 mb-2 bg-danger text-white");
            document.getElementById('pumpState').innerHTML = "Uruchomiona";
          }
          else if (pumpState === 0){
            $("#pumpStatusArea").attr("class", "p-3 mb-2 bg-success text-white");
            document.getElementById('pumpState').innerHTML = "Wyłączona";
          }          
      };

      chatSocket.onclose = function(e) {
          chatSocket.close();
          console.error('Padło');
      };

      setInterval(function(){ 
        chatSocket.send(JSON.stringify({
          'message': ''
        })); 
      }, 1000);
    });
  </script>
  <script type="text/javascript" src="/static/js/Chart.bundle.min.js"></script>
  <script>
    //$(document).ready(function(){
      // var ctx = document.getElementById('myChart');
      // console.log("chartings")
      // var myChart = new Chart(ctx, {
      // type: 'bar',
      // data: {
      //     labels: ['Red', 'Blue', 'Yellow', 'Green', 'Purple', 'Orange'],
      //     datasets: [{
      //         label: '# of Votes',
      //         data: [12, 19, 3, 5, 2, 3],
      //         backgroundColor: [
      //             'rgba(255, 99, 132, 0.2)',
      //             'rgba(54, 162, 235, 0.2)',
      //             'rgba(255, 206, 86, 0.2)',
      //             'rgba(75, 192, 192, 0.2)',
      //             'rgba(153, 102, 255, 0.2)',
      //             'rgba(255, 159, 64, 0.2)'
      //         ],
      //         borderColor: [
      //             'rgba(255, 99, 132, 1)',
      //             'rgba(54, 162, 235, 1)',
      //             'rgba(255, 206, 86, 1)',
      //             'rgba(75, 192, 192, 1)',
      //             'rgba(153, 102, 255, 1)',
      //             'rgba(255, 159, 64, 1)'
      //         ],
      //         borderWidth: 1
      //     }]
      // },
      // options: {
      //     scales: {
      //         yAxes: [{
      //             ticks: {
      //                 beginAtZero: true
      //             }
      //         }]
      //     }
      //   }
      // });
    //});
  </script>
{% endblock %}